<%- include('../partials/header') %>

<section class="users-section">
  <div class="container">

    <!-- Top row: search + New User -->
    <div class="users-controls" style="display:flex;justify-content:space-between;align-items:center;margin-bottom:1.5rem; margin-top: 3rem;">
      <input
        id="user-search"
        type="text"
        class="search-input"
        placeholder="Search users…"
        style="flex:1;max-width:300px;padding:0.5rem;border:1px solid #ddd;border-radius:0.25rem;"
      >
      <button
        id="new-user-btn"
        class="btn btn-primary"
        style="margin-left:1rem;"
      >New User</button>
    </div>

    <!-- Tabs: All / Admin / Organization -->
    <div class="users-tabs" style="margin-bottom:1.5rem;text-align:center;">
      <button class="tab filter-btn active" data-filter="all">All</button>
      <button class="tab filter-btn"        data-filter="admin">Admin</button>
      <button class="tab filter-btn"        data-filter="organization">Organization</button>
    </div>

    <!-- List of users -->
    <div id="users-container" class="users-list">
      <% if (users.length) { %>
        <% users.forEach(u => { %>
          <div
            class="user-record"
            data-id="<%= u._id %>"
            data-user-type="<%= u.userType %>"
            data-name="<%= u.name %>"
            data-email="<%= u.email %>"
            data-phone="<%= u.phone %>"
            style="position:relative;padding:1rem;border:1px solid #eee;border-radius:0.25rem;margin-bottom:1rem;"
          >
            <p style="margin:0;font-weight:600;">
              <%= u.name %> <span style="font-weight:400;">(<%= u.userType %>)</span>
            </p>
            <p style="margin:0.25rem 0 0;font-size:0.9rem;color:#555;">
              <%= u.email %> │ <%= u.phone %>
            </p>

            <!-- Admin-only action buttons -->
            <div
                class="user-actions auth-only hidden"
                data-user-type="admin"
                style="
                    position: absolute;
                    bottom: 1rem;
                    right: 1rem;
                    display: flex;
                    gap: 0.5rem;
                "
                >
                <button class="btn btn-secondary delete-user-btn">Delete</button>
                <button class="btn btn-secondary update-user-btn">Update</button>
                </div>
                </div>
                <% }) %>
                <% } else { %>
                    <p class="no-data">No users found.</p>
                <% } %>
            </div>
  </div>
</section>

<!-- Create / Update User Modal -->
<div id="user-modal" class="modal hidden auth-only" data-user-type="admin">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <button class="modal-close">&times;</button>
    <h2 id="user-modal-title">New User</h2>
    <form id="user-form">
      <input type="hidden" id="user-id" name="id">
      <div>
        <label for="user-name">Name</label>
        <input type="text" id="user-name" name="name" required maxlength="100">
      </div>
      <div>
        <label for="user-email">Email</label>
        <input type="email" id="user-email" name="email" required>
      </div>
      <div>
        <label for="user-phone">Phone</label>
        <input type="text" id="user-phone" name="phone" required>
      </div>
      <div>
        <label for="user-type">Type</label>
        <select id="user-type" name="userType" required>
          <option value="admin">Admin</option>
          <option value="organization">Organization</option>
        </select>
      </div>
      <button type="submit" id="user-submit-btn" class="btn btn-primary">Create</button>
    </form>
  </div>
</div>

<!-- Delete Confirmation Modal -->
<div id="delete-user-modal" class="modal hidden auth-only" data-user-type="admin">
  <div class="modal-overlay"></div>
  <div class="modal-content">
    <button class="modal-close">&times;</button>
    <h2>Confirm Delete</h2>
    <p>Are you sure you want to delete this user?</p>
    <button id="confirm-delete-user-btn" class="btn btn-danger">Delete</button>
    <button id="cancel-delete-user-btn"  class="btn btn-secondary">Cancel</button>
  </div>
</div>

<%- include('../partials/footer') %>
<script src="/js/users.js" defer></script>
